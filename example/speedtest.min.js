!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.SpeedTest=e()}}(function(){return function e(t,n,i){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(r)return r(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var h=n[o]={exports:{}};t[o][0].call(h.exports,function(e){var n=t[o][1][e];return s(n?n:e)},h,h.exports,e,t,n,i)}return n[o].exports}for(var r="function"==typeof require&&require,o=0;o<i.length;o++)s(i[o]);return s}({1:[function(e,t){"use strict";var n=e("./modules/latency"),i=e("./modules/bandwidth"),s=t.exports=function(e){this._modules={},this._setModule("latency",new n(e))._setModule("upload",new i("upload",e))._setModule("download",new i("download",e))},r=s.prototype;r.module=function(e){return this._modules[e]||null},r.isRequesting=function(){var e=this._modules,t=!1;for(var n in e)e.hasOwnProperty(n)&&(t=t||e[n].isRequesting());return t},r._setModule=function(e,t){var n=this;return t&&(this._modules[e]=t.on("_newRequest",function(){return!n.isRequesting()})),this}},{"./modules/bandwidth":3,"./modules/latency":5}],2:[function(e,t){"use strict";var n=t.exports=function(){this._events={}},i=n.prototype;i.on=function(e,t){var n=this._events[e];return n||(n=this._events[e]=[]),~n.indexOf(t)||n.push(t),this},i.off=function(e,t){var n=this._events[e];if("undefined"==typeof t&&n)delete this._events[e];else{var i=n?n.indexOf(t):-1;~i&&n.splice(i,1)}return this},i.trigger=function(e,t,n){var i=this._events[e]||[];t=t||[];var s=!0;return i.forEach(function(e){var n=e.apply(this,t);n=n!==!1?!0:!1,s=s&&n},n),s}},{}],3:[function(e,t){"use strict";var n=e("./http"),i=e("../timing"),s=e("../utilities"),r=t.exports=function(e,t){var i=["upload","download"];e=~i.indexOf(e)?e:"download",t=s.extend({dataSize:{upload:2097152,download:10485760,multiplier:2}},t),n.call(this,e,t),this._loadingType=e,this._intendedEnd=!1,this._isRestarting=!1,this._lastLoadedValue=null,this._speedRecords=[],this._avgSpeed=null,this._requestID=0,this._progressID=0,this._timingLabels={start:null,progress:null,end:null,measure:null},this._initBandwidthConfig()},o=r.prototype=Object.create(n.prototype);o.start=function(){var e=this._loadingType,t=this._options.dataSize,n=this._requestID++;this._intendedEnd=!1,this._lastLoadedValue=null,this._speedRecords=[],this._isRestarting||this.trigger("start",["upload"==e?t.upload:t.download]);var i=this._timingLabels;i.start=e+"-"+n+"-start",i.progress=e+"-"+n+"-progress",i.end=e+"-"+n+"-end",i.measure=e+"-"+n+"-measure";var s="upload"==e?new Blob([new ArrayBuffer(t.upload)]):null,r="download"==e?"GET":"POST";this._newRequest(r,{size:t.download})._sendRequest(s)},o.abort=function(){return this._intendedEnd=!0,this._abort()},o._initBandwidthConfig=function(){var e=this,t=this._loadingType,n="upload"==t?"xhr-upload-":"xhr-";this.on(n+"loadstart",function(){i.mark(e._timingLabels.start)}),this.on(n+"progress",function(t){e._progress(t)}),this.on(n+"timeout",function(){e._timeout()}),this.on(n+"loadend",function(){e._end()})},o._progress=function(e){var t=this._timingLabels,n=this._progressID++,s=t.progress+"-"+n,r=e.loaded;i.mark(s);var o,u=i.measure(t.measure+"-avg-"+n,t.start,s),a=r/u*1e3;if(this._lastLoadedValue){var d=i.measure(t.measure+"-instant-"+n,t.progress+"-"+(n-1),s);o=(r-this._lastLoadedValue)/d*1e3}else o=a;this._lastLoadedValue=r,this._avgSpeed=a,this._speedRecords.push(o),this.trigger("progress",[a,o])},o._timeout=function(){this._intendedEnd=!0},o._end=function(){if(this._intendedEnd)this._isRestarting=!1,this.trigger("end",[this._avgSpeed,this._speedRecords]);else{var e=this._loadingType,t=this._options.dataSize;t.upload*=t.multiplier,t.download*=t.multiplier,this.trigger("restart",["upload"==e?t.upload:t.download]),this._isRestarting=!0,this.start()}}},{"../timing":6,"../utilities":7,"./http":4}],4:[function(e,t){"use strict";var n=e("../event-dispatcher"),i=e("../utilities"),s=t.exports=function(e,t){n.call(this),t=i.extend({endpoint:"./speedtest.php",delay:8e3},t),this._options=t,this._moduleName=e,this._xhr=null,this._lastURLToken=null,this._requestingOverridden=!1,this._requesting=!1,this._initHttpConfig()},r=s.prototype=Object.create(n.prototype);r.isRequesting=function(){return this._requesting},r._initHttpConfig=function(){var e=this,t=function(){e._requestingOverridden||(e._requesting=!0)};this.on("xhr-loadstart",t),this.on("xhr-upload-loadstart",t);var n=function(){e._requestingOverridden||(e._requesting=!1)};this.on("xhr-loadend",n),this.on("xhr-upload-loadend",n)},r._newRequest=function(e,t){if(!this.trigger("_newRequest")&&!this._requestingOverridden)return console.warn("To ensure accurate measures, you can only make one request at a time."),this;var n=this,i=this._options,s=new XMLHttpRequest,r=["GET","POST"];if(!~r.indexOf(e))return console.warn("The HTTP method must be GET or POST."),this;t=t||{},this._lastURLToken="speedtest-"+(new Date).getTime();var o=i.endpoint;o+=(~o.indexOf("?")?"&":"?")+"module="+this._moduleName,Object.keys(t).forEach(function(e){o+="&"+e+"="+encodeURIComponent(t[e])}),o+="&"+this._lastURLToken,s.open(e,o),s.timeout=i.delay,this._xhr&&this._xhr.readyState==XMLHttpRequest.OPENED&&this._xhr.abort(),this._xhr=s;var u=["loadstart","progress","abort","error","load","timeout","loadend","readystatechange"];return u.forEach(function(e){s.addEventListener(e,function(){("progress"!=e||n._requesting)&&n.trigger("xhr-"+e,arguments,s)}),"readystatechange"!=e&&s.upload.addEventListener(e,function(){n.trigger("xhr-upload-"+e,arguments,s)})}),this},r._sendRequest=function(e){return this._xhr&&this._xhr.readyState==XMLHttpRequest.OPENED?this._xhr.send("undefined"!=typeof e?e:null):console.warn("A request must have been created before it can be sent."),this},r._abort=function(){return this._xhr&&this._xhr.abort(),this},r._getTimingEntry=function(e){return setTimeout(function(t){return function(){var n=performance.getEntriesByType("resource").filter(function(e){return~e.name.indexOf(t)});"function"==typeof e&&e(n.length?n[0]:null)}}(this._lastURLToken),0),this},r._setRequesting=function(e){this._requestingOverridden=!0,this._requesting=e}},{"../event-dispatcher":2,"../utilities":7}],5:[function(e,t){"use strict";var n=e("./http"),i=e("../timing"),s=e("../utilities"),r=t.exports=function(e){e=s.extend(e,{delay:0}),n.call(this,"latency",e),this._requestsLeft=0,this._latencies=[],this._requestID=0,this._timingLabels={start:null,end:null,measure:null},this._initLatencyConfig()},o=r.prototype=Object.create(n.prototype);o.start=function(){return this._requestsLeft=5,i.supportsResourceTiming()||this._requestsLeft++,this._setRequesting(!0),this._latencies=[],this._nextRequest(),this},o._initLatencyConfig=function(){var e=this;if(i.supportsResourceTiming())this.on("xhr-load",function(){e._getTimingEntry(function(t){var n=t.secureConnectionStart?t.secureConnectionStart-t.connectStart:t.connectEnd-t.connectStart;e._latencies.push(n)})});else{var t=this._timingLabels;this.on("xhr-loadstart",function(){i.mark(t.start)}),this.on("xhr-readystatechange",function(){e._requestsLeft<5&&this.readyState==XMLHttpRequest.HEADERS_RECEIVED&&(i.mark(t.end),e._latencies.push(i.measure(t.measure,t.start,t.end)))})}this.on("xhr-load",function(){e._nextRequest()})},o._nextRequest=function(){if(this._requestsLeft--){var e=this._requestID++,t=this._timingLabels;t.start="latency-"+e+"-start",t.end="latency-"+e+"-end",t.measure="latency-"+e+"-measure",this._newRequest("GET")._sendRequest()}else{var n=this;this._setRequesting(!1),setTimeout(function(){n._calculate()},0)}},o._calculate=function(){var e=this._latencies,t=!1,n=e.reduce(function(e,n){return t=t||0==e||0==n,e+n})/e.length;t&&console.warn(["At least one latency returned a zero value, this can be due to the configuration of your web server which","is probably using persistant connections. Check the documentation to solve this problem."].join(" ")),this.trigger("end",[n,e])}},{"../timing":6,"../utilities":7,"./http":4}],6:[function(e,t){"use strict";var n=t.exports=function(){},i=n;i._marks={},i._measures={},i._support={performance:!!window.performance,userTiming:window.performance&&performance.mark,resourceTiming:window.performance&&"function"==typeof performance.getEntriesByType&&performance.timing},i.mark=function(e){var t=this._support,n=this._marks;return t.userTiming?performance.mark(e):n[e]=t.performance?performance.now():(new Date).getTime(),this},i.measure=function(e,t,n){var i=this._support,s=this._marks,r=this._measures;return"undefined"==typeof r[e]&&(i.userTiming?(performance.measure(e,t,n),r[e]=performance.getEntriesByName(e)[0].duration):r[e]=s[n]-s[t]),r[e]},i.supportsResourceTiming=function(){return this._support.resourceTiming}},{}],7:[function(e,t,n){"use strict";function i(e,t){return e=JSON.parse(JSON.stringify(e||{})),t=JSON.parse(JSON.stringify(t||{})),Object.keys(t).forEach(function(n){e[n]=t[n]}),e}n.extend=i},{}]},{},[1])(1)});
//# sourceMappingURL=speedtest.min.js.map